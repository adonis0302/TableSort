/*
* TableSorter 2.0 - Client-side table sorting with ease!
* Version 2.0.6
* Copyright (c) 2007 Christian Bach
*/

(function(c){c.extend({tablesorter:new function(){function a(b){typeof console!=="undefined"&&typeof console.debug!=="undefined"?console.log(b):alert(b)}function k(b,d){a(b+","+((new Date).getTime()-d.getTime())+"ms")}function o(b,d){var a="";if(!d)return"";if(!b.supportsTextContent)b.supportsTextContent=d.textContent||!1;return a=b.textExtraction==="simple"?b.supportsTextContent?d.textContent:d.childNodes[0]&&d.childNodes[0].hasChildNodes()?d.childNodes[0].innerHTML:d.innerHTML:typeof b.textExtraction=== "function"?b.textExtraction(d):c(d).text()}function i(b){var d,a=p.length;for(d=0;d<a;d++)if(p[d].id.toLowerCase()===b.toLowerCase())return p[d];return!1}function q(b,d){if(b.tBodies.length!==0){var r=b.tBodies[0].rows,h,e,g,f,l="";if(r[0]){h=[];e=r[0].cells;e=e.length;for(g=0;g<e;g++){f=!1;c.metadata&&c(d[g]).metadata()&&c(d[g]).metadata().sorter?f=i(c(d[g]).metadata().sorter):b.config.headers[g]&&b.config.headers[g].sorter&&(f=i(b.config.headers[g].sorter));if(!f)a:{f=b;for(var j=r,m=-1,k=g,n=void 0, t=p.length,v=!1,w="",n=!0;w===""&&n;)m++,j[m]?(v=j[m].cells[k],w=c.trim(o(f.config,v)),f.config.debug&&a("Checking if value was empty on row:"+m)):n=!1;for(n=1;n<t;n++)if(p[n].is(w,f,v)){f=p[n];break a}f=p[0]}b.config.debug&&(l+="column:"+g+" parser:"+f.id+"\n");h.push(f)}}b.config.debug&&a(l);return h}}function z(b){var d=b.tBodies[0]&&b.tBodies[0].rows.length||0,a=b.tBodies[0].rows[0]&&b.tBodies[0].rows[0].cells.length||0,h=b.config.parsers,e={row:[],normalized:[]},g,f,l,j,m;b.config.debug&&(m= new Date);for(g=0;g<d;++g)if(l=c(b.tBodies[0].rows[g]),j=[],l.hasClass(b.config.cssChildRow))e.row[e.row.length-1]=e.row[e.row.length-1].add(l);else{e.row.push(l);for(f=0;f<a;++f)j.push(h[f].format(o(b.config,l[0].cells[f]),b,l[0].cells[f]));j.push(e.normalized.length);e.normalized.push(j)}b.config.debug&&k("Building cache for "+d+" rows:",m);return e}function A(b){var d,a=u.length;for(d=0;d<a;d++)if(u[d].id.toLowerCase()===b.toLowerCase())return u[d]}function x(b){var d=b.config.widgets,a,c=d.length; for(a=0;a<c;a++)A(d[a]).format(b)}function y(b,d){var a=d.row,h=d.normalized,e=h.length,g=h[0].length-1,f=c(b.tBodies[0]),l=[],j,m,o,n,t;b.config.debug&&(t=new Date);for(j=0;j<e;j++)if(n=h[j][g],l.push(a[n]),!b.config.appender){o=a[n].length;for(m=0;m<o;m++)f[0].appendChild(a[n][m])}b.config.appender&&b.config.appender(b,l);l=null;b.config.debug&&k("Rebuilt table:",t);x(b);setTimeout(function(){c(b).trigger("sortEnd")},0)}function E(b){var a=[],c={},b=b.getElementsByTagName("THEAD")[0].getElementsByTagName("TR"), h,e,g,f,l,j,m,k,n,o;for(h=0;h<b.length;h++){l=b[h].cells;for(e=0;e<l.length;e++){g=l[e];j=g.parentNode.rowIndex;f=j+"-"+g.cellIndex;m=g.rowSpan||1;k=g.colSpan||1;typeof a[j]==="undefined"&&(a[j]=[]);for(g=0;g<a[j].length+1;g++)if(typeof a[j][g]==="undefined"){n=g;break}c[f]=n;for(g=j;g<j+m;g++){typeof a[g]==="undefined"&&(a[g]=[]);o=a[g];for(f=n;f<n+k;f++)o[f]="x"}}}return c}function B(b,a){if(b.config.headers[a]&&b.config.headers[a].lockedOrder)return b.config.headers[a].lockedOrder;return!1}function F(b){var d= E(b),r,h;b.config.debug&&(r=new Date);h=c(b.config.selectorHeaders,b).wrapInner("<span/>").each(function(a){this.column=d[this.parentNode.rowIndex+"-"+this.cellIndex];this.count=this.order=typeof b.config.sortInitialOrder!=="Number"?b.config.sortInitialOrder.toLowerCase()==="desc"?1:0:b.config.sortInitialOrder===1?1:0;if(c.metadata&&c(this).metadata().sorter===!1||b.config.headers[a]&&b.config.headers[a].sorter===!1)this.sortDisabled=!0;if(B(b,a))this.order=this.lockedOrder=B(b,a);if(!this.sortDisabled){var g= c(this).addClass(b.config.cssHeader);b.config.onRenderHeader&&b.config.onRenderHeader.apply(g)}b.config.headerList[a]=this});b.config.debug&&(k("Built headers:",r),a(h));return h}function G(b,a){var c,h=a.length;for(c=0;c<h;c++)if(a[c][0]===b)return!0;return!1}function C(b,a,k,h){a.removeClass(h[0]).removeClass(h[1]);var e=[];a.each(function(){this.sortDisabled||(e[this.column]=c(this))});a=k.length;for(b=0;b<a;b++)e[k[b][0]].addClass(h[k[b][1]])}function H(b){var a;b.config.widthFixed&&(a=c("<colgroup>"), c("tr:first td",b.tBodies[0]).each(function(){a.append(c("<col>").css("width",c(this).width()))}),c(b).prepend(a))}function D(a,c,o){var h="var sortWrapper = function(a,b) {",e=c.length,g,f,l,j,m,i;a.config.debug&&(g=new Date);for(f=0;f<e;f++)l=c[f][0],i=c[f][1],j=a.config.parsers[l].type==="text"?i===0?"sortText":"sortTextDesc":i===0?"sortNumeric":"sortNumericDesc",m="e"+f,h+="var "+m+" = "+j+"(a["+l+"],b["+l+"]); ",h+="if ("+m+") { return "+m+"; } ",h+="else { ";f=o.normalized[0].length-1;h+="return a["+ f+"]-b["+f+"];";for(f=0;f<e;f++)h+="}; ";h+="return 0; ";h+="}; ";eval(h);o.normalized.sort(sortWrapper);a.config.debug&&k("Sorting on "+c.toString()+" and dir "+i+" time:",g);return o}var p=[],u=[];this.defaults={cssHeader:"header",cssAsc:"headerSortUp",cssDesc:"headerSortDown",cssChildRow:"expand-child",sortInitialOrder:"asc",sortMultiSortKey:"shiftKey",sortForce:null,sortAppend:null,sortLocaleCompare:!1,textExtraction:"simple",parsers:{},widgets:[],widgetZebra:{css:["even","odd"]},headers:{},widthFixed:!1, cancelSelection:!0,sortList:[],headerList:[],dateFormat:"us",decimal:/\.|\,/g,onRenderHeader:null,selectorHeaders:"thead th",tableClass:"tablesorter",debug:!1};this.benchmark=k;this.construct=function(a){return this.each(function(){if(this.tHead&&this.tBodies){var d,k,h,e,g,f,l,j,m,i,n;this.config={};e=c.extend(this.config,c.tablesorter.defaults,a);d=c(this).addClass(this.config.tableClass);c.data(this,"tablesorter",e);k=F(this);this.config.parsers=q(this,k);h=z(this);g=[e.cssDesc,e.cssAsc];H(this); k.click(function(a){f=d[0].tBodies[0]&&d[0].tBodies[0].rows.length||0;if(!this.sortDisabled&&f>0){d.trigger("sortStart");c(this);l=this.column;this.order=this.count++%2;if(this.lockedOrder)this.order=this.lockedOrder;if(a[e.sortMultiSortKey])if(G(l,e.sortList))for(j=0;j<e.sortList.length;j++){if(i=e.sortList[j],n=e.headerList[i[0]],i[0]===l)n.count=i[1],n.count++,i[1]=n.count%2}else e.sortList.push([l,this.order]);else{e.sortList=[];if(e.sortForce!==null){m=e.sortForce;for(j=0;j<m.length;j++)m[j][0]!== l&&e.sortList.push(m[j])}e.sortList.push([l,this.order])}setTimeout(function(){C(d[0],k,e.sortList,g);y(d[0],D(d[0],e.sortList,h))},1);return!1}}).mousedown(function(){if(e.cancelSelection)return this.onselectstart=function(){return!1},!1});d.bind("update",function(){var a=this;setTimeout(function(){a.config.parsers=q(a,k);h=z(a)},1)}).bind("updateCell",function(a,b){var c=this.config,d=[b.parentNode.rowIndex-1,b.cellIndex];h.normalized[d[0]][d[1]]=c.parsers[d[1]].format(o(c,b),b)}).bind("sorton", function(a,b){c(this).trigger("sortStart");e.sortList=b;var d=e.sortList,f,j,l,o=this.config,i=d.length;for(f=0;f<i;f++)j=d[f],l=o.headerList[j[0]],l.count=j[1],l.count++;C(this,k,d,g);y(this,D(this,d,h))}).bind("appendCache",function(){y(this,h)}).bind("applyWidgetId",function(a,b){A(b).format(this)}).bind("applyWidgets",function(){x(this)});if(c.metadata&&c(this).metadata()&&c(this).metadata().sortlist)e.sortList=c(this).metadata().sortlist;e.sortList.length>0&&d.trigger("sorton",[e.sortList]); x(this)}})};this.addParser=function(a){var c,k=p.length,h=!0;for(c=0;c<k;c++)p[c].id.toLowerCase()===a.id.toLowerCase()&&(h=!1);h&&p.push(a)};this.addWidget=function(a){u.push(a)};this.formatFloat=function(a){a=parseFloat(a);return isNaN(a)?0:a};this.formatInt=function(a){a=parseInt(a,10);return isNaN(a)?0:a};this.isDigit=function(a){return/^[\-+]?\d*$/.test(c.trim(a.replace(/[,.']/g,"")))};this.clearTableBody=function(a){c.browser.msie?function(){for(;this.firstChild;)this.removeChild(this.firstChild)}.apply(a.tBodies[0]): a.tBodies[0].innerHTML=""}}})();c.fn.extend({tablesorter:c.tablesorter.construct});var i=c.tablesorter;i.addParser({id:"text",is:function(){return!0},format:function(a){return c.trim(a.toLocaleLowerCase())},type:"text"});i.addParser({id:"digit",is:function(a,k){return c.tablesorter.isDigit(a,k.config)},format:function(a){return c.tablesorter.formatFloat(a)},type:"numeric"});i.addParser({id:"currency",is:function(a){return/^[\u00a3$\u20ac?.]/.test(a)},format:function(a){return c.tablesorter.formatFloat(a.replace(RegExp(/[\u00a3$\u20ac]/g), ""))},type:"numeric"});i.addParser({id:"ipAddress",is:function(a){return/^\d{2,3}[\.]\d{2,3}[\.]\d{2,3}[\.]\d{2,3}$/.test(a)},format:function(a){for(var k,i=a.split("."),s="",q=i.length,a=0;a<q;a++)k=i[a],s+=k.length===2?"0"+k:k;return c.tablesorter.formatFloat(s)},type:"numeric"});i.addParser({id:"url",is:function(a){return/^(https?|ftp|file):\/\/$/.test(a)},format:function(a){return c.trim(a.replace(RegExp(/(https?|ftp|file):\/\//),""))},type:"text"});i.addParser({id:"isoDate",is:function(a){return/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/.test(a)}, format:function(a){return c.tablesorter.formatFloat(a!==""?(new Date(a.replace(RegExp(/-/g),"/"))).getTime():"0")},type:"numeric"});i.addParser({id:"percent",is:function(a){return/\%$/.test(c.trim(a))},format:function(a){return c.tablesorter.formatFloat(a.replace(RegExp(/%/g),""))},type:"numeric"});i.addParser({id:"usLongDate",is:function(a){return a.match(RegExp(/^[A-Za-z]{3,10}\.? [0-9]{1,2}, ([0-9]{4}|'?[0-9]{2}) (([0-2]?[0-9]:[0-5][0-9])|([0-1]?[0-9]:[0-5][0-9]\s(AM|PM)))$/))},format:function(a){return c.tablesorter.formatFloat((new Date(a)).getTime())}, type:"numeric"});i.addParser({id:"shortDate",is:function(a){return/\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}/.test(a)},format:function(a,k){var i=k.config,a=a.replace(/\-/g,"/");if(i.dateFormat==="us")a=a.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/,"$3/$1/$2");else if(i.dateFormat==="uk")a=a.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/,"$3/$2/$1");else if(i.dateFormat==="dd/mm/yy"||i.dateFormat==="dd-mm-yy")a=a.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2})/,"$1/$2/$3");return c.tablesorter.formatFloat((new Date(a)).getTime())}, type:"numeric"});i.addParser({id:"time",is:function(a){return/^(([0-2]?[0-9]:[0-5][0-9])|([0-1]?[0-9]:[0-5][0-9]\s(am|pm)))$/.test(a)},format:function(a){return c.tablesorter.formatFloat((new Date("2000/01/01 "+a)).getTime())},type:"numeric"});i.addParser({id:"metadata",is:function(){return!1},format:function(a,k,i){a=k.config;a=!a.parserMetadataName?"sortValue":a.parserMetadataName;return c(i).metadata()[a]},type:"numeric"});i.addWidget({id:"zebra",format:function(a){var i,o=-1,s,q;a.config.debug&& (q=new Date);c("tr:visible",a.tBodies[0]).each(function(){i=c(this);i.hasClass(a.config.cssChildRow)||o++;s=o%2===0;i.removeClass(a.config.widgetZebra.css[s?0:1]).addClass(a.config.widgetZebra.css[s?1:0])});a.config.debug&&c.tablesorter.benchmark("Applying Zebra widget",q)}})})(jQuery);
