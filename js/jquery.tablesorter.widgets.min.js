/* TableSorter 2.0 Widgets - updated 1/31/2012 */

(function(b){
b.tablesorter.addWidget({id:"uitheme",format:function(f){var c,a,d,g,e,h=f.config,i=b(f),j=["ui-icon-arrowthick-2-n-s","ui-icon-arrowthick-1-s","ui-icon-arrowthick-1-n"];h.widgetUitheme&&h.widgetUitheme.hasOwnProperty("css")&&(j=h.widgetUitheme.css||j);d=j.join(" ");h.debug&&(c=new Date);i.is(".ui-theme")||(i.addClass("ui-widget ui-widget-content ui-corner-all ui-theme"),b.each(h.headerList,function(){b(this).addClass("ui-widget-header ui-corner-all").append('<span class="ui-icon"/>').wrapInner('<div class="inner"/>').hover(function(){b(this).addClass("ui-state-hover")}, function(){b(this).removeClass("ui-state-hover")})}));b.each(h.headerList,function(c){g=b(this);this.sortDisabled?g.find("span.ui-icon").removeClass(d+" ui-icon"):(a=g.hasClass(h.cssAsc)?j[1]:g.hasClass(h.cssDesc)?j[2]:g.hasClass(h.cssHeader)?j[0]:"",e=i.hasClass("hasStickyHeaders")?i.find("tr.stickyHeader").find("th").eq(c).add(g):g,e[a===j[0]?"removeClass":"addClass"]("ui-state-active").find("span.ui-icon").removeClass(d).addClass(a))});h.debug&&b.tablesorter.benchmark("Applying uitheme widget", c)}});
b.tablesorter.addWidget({id:"columns",format:function(f){var c,a,d,g,e=f.config,h=e.sortList,i=h.length,j=["primary","secondary","tertiary"];e.widgetColumns&&e.widgetColumns.hasOwnProperty("css")&&(j=e.widgetColumns.css||j);d=j.length-1;g=j.join(" ");e.debug&&(a=new Date);h&&h[0]&&b("tr:visible",f.tBodies[0]).each(function(a){c=b(this).children().removeClass(g);c.eq(h[0][0]).addClass(j[0]);if(1<i)for(a=1;a<i;a++)c.eq(h[a][0]).addClass(j[a]||j[d])});e.debug&&b.tablesorter.benchmark("Applying Columns widget", a)}});
b.tablesorter.addWidget({id:"filter",format:function(f){if(!f.config.filtering){var c,a,d,g,e,h,i=f.config,j=i.headerList.length,k=b(f),f='<tr class="filters">',l;i.debug&&(l=new Date);for(c=0;c<j;c++)f+='<td><input type="text" class="filter" data-col="'+c+'" style="',f+=i.headers[c]&&"filter"in i.headers[c]&&!1===i.headers[c].filter||b(i.headerList[c]).is(".filter-false")?"display:none":"",f+='"></td>';k.find("thead").append(f+="</tr>").find(".filter").bind("keyup",function(){a=k.find(".filter").map(function(){return(b(this).val()|| "").toLowerCase()}).get();""===a.join("")?k.find("tr").show():k.find("tbody").find("tr:not(.expand-child)").each(function(){d=!0;e=b(this).nextUntil("tr:not(.expand-child)");g=e.length&&("undefined"!==typeof i.widgetFilterChildRows?i.widgetFilterChildRows:1)?e.text():"";h=b(this).find("td");for(c=0;c<j;c++)""!==a[c]&&0<=(h.eq(c).text()+g).toLowerCase().indexOf(a[c])?d=d?!0:!1:""!==a[c]&&(d=!1);b(this)[d?"show":"hide"]();if(e.length)e[d?"show":"hide"]()});k.trigger("applyWidgets")});i.filtering=!0; i.debug&&b.tablesorter.benchmark("Applying Filter widget",l)}}});
b.tablesorter.addWidget({id:"stickyHeaders",format:function(f){if(!b(f).hasClass("hasStickyHeaders")){var c=b(f).addClass("hasStickyHeaders"),a=b(window),d=b(f).find("thead"),g=d.find("tr").children(),e=g.eq(0),h=parseInt(g.eq(0).css("border-left-width"),10),i=d.find("tr:not(.filters)").clone().addClass("stickyHeader").css({width:d.outerWidth()+2*h,position:"fixed",left:e.offset().left,marginLeft:-h,top:0,visibility:"hidden",zIndex:10}), j=i.children(),k;c.bind("sortEnd",function(a,c){var e=b(c).find("thead tr"),d=e.filter(".stickyHeader").children();e.filter(":not(.stickyHeader)").children().each(function(a){d.eq(a).attr("class",b(this).attr("class"))})}).bind("pagerComplete",function(){a.resize()});g.each(function(a){var c=b(this);j.eq(a).width(c.width()).bind("click",function(a){c.trigger(a)}).bind("mousedown",function(){this.onselectstart=function(){return!1};return!1})});d.prepend(i);a.scroll(function(){var b=e.offset(),d=a.scrollTop(), d=d>b.top&&d<b.top+c.find("tbody").height()?"visible":"hidden";i.css({left:b.left-a.scrollLeft(),visibility:d});d!==k&&(a.resize(),k=d)}).resize(function(){i.css({left:e.offset().left-a.scrollLeft(),width:d.outerWidth()+2*h});j.each(function(a){b(this).width(g.eq(a).width())})})}}});
b.tablesorter.addWidget({id:"resizable",format:function(f){if(!f.config.resizable){var c,a=f.config,d=a.headerList,g=d.length,e=function(){a.resizable_position=0;a.resizable_target=null;b(window).trigger("resize")};a.resizable_target= null;a.resizable_position=0;for(c=1;c<g;c++)b(d[c]).append('<div class="resizer" style="cursor:w-resize;position:absolute;height:100%;width:20px;left:-20px;top:0;z-index:1;"></div>').wrapInner('<div style="position:relative;height:100%;width:100%"></div>').find(".resizer").bind("mousedown",function(c){a.resizable_target=b(c.target).closest("th");a.resizable_position=c.pageX}).end().bind("mousemove",function(c){if(!(0===a.resizable_position||null===typeof a.resizable_target)){var b=c.pageX-a.resizable_position, d=a.resizable_target.closest("th").prev();a.resizable_target.width()<-b||d&&d.width()<=b||(d.width(d.width()+b),a.resizable_position=c.pageX)}}).bind("mouseup",function(){e();return!1});b(f).find("thead").bind("mouseup mouseleave",function(){e()});a.resizable=!0}}});
b.tablesorter.addWidget({id:"saveSort",format:function(f){var c,a,d,g,e=f.config;d='{"sortList":'+JSON.stringify(e.sortList)+"}";e.debug&&(g=new Date);if(e.widgetsavesort)c="tablesorter"+(e.tableIndex||0)+f.id,e.hasLocalStorage?localStorage[c]= d:(a=new Date,a.setTime(a.getTime()+31536E6),document.cookie=c+"="+d+"; expires="+a.toGMTString()+"; path=/"),e.debug&&b.tablesorter.benchmark('saveSort: Saving sort to "'+c+'" in '+(e.hasLocalStorage?"local storage":"a cookie"),g);else{e.widgetsavesort=!0;e.hasLocalStorage=!1;try{localStorage.getItem&&(e.hasLocalStorage=!0)}catch(h){}e.tableIndex=b(".tablesorter").index(b(f));c="tablesorter"+(e.tableIndex||0)+f.id;e.hasLocalStorage?a=localStorage[c]:(d=document.cookie.split(/[;\s|=]/),a=b.inArray(c, d)+1,a=0!==a?d[a]:"");try{a=b.parseJSON(a)}catch(i){a=""}d=a&&a.hasOwnProperty("sortList")&&b.isArray(a.sortList)?[a.sortList]:"";e.debug&&b.tablesorter.benchmark('saveSort: Last sort for "'+c+'" obtained from '+(e.hasLocalStorage?"local storage":"a cookie"),g);d&&0<d.length&&b(f).trigger("sorton",d)}}})
})(jQuery);